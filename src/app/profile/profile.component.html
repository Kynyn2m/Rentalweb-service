<div class="profile-page-container">
  <!-- Sticky Profile Information on the Left -->
  <div class="profile-container sticky">
    <div class="profile-header-bar"></div>

    <div class="profile-photo">
      <img [src]="user.avatarUrl || '/assets/img/user.png'"
           alt="User Photo"
           class="user-photo"
           (error)="onImageError($event)">
      <input type="file"
             (change)="onFileSelected($event)"
             hidden
             #fileInput>
      <button mat-icon-button
              color="primary"
              (click)="fileInput.click()"
              class="change-photo-icon">
        <mat-icon>camera_alt</mat-icon>
      </button>
    </div>

    <mat-card>
      <mat-card-content>
        <div class="user-info-grid">
          <!-- ID (readonly) -->
          <mat-form-field appearance="outline"
                          class="full-width">
            <mat-label>ID</mat-label>
            <input matInput
                   [value]="user.id"
                   readonly>
          </mat-form-field>

          <!-- Full Name -->
          <mat-form-field appearance="outline"
                          class="full-width">
            <mat-label>Full Name</mat-label>
            <input matInput
                   [(ngModel)]="user.fullName">
          </mat-form-field>

          <!-- Username -->
          <mat-form-field appearance="outline"
                          class="full-width">
            <mat-label>Username</mat-label>
            <input matInput
                   disabled
                   [(ngModel)]="user.username">
          </mat-form-field>

          <!-- Gender -->
          <mat-form-field appearance="outline"
                          class="full-width">
            <mat-label>Gender</mat-label>
            <mat-select [(ngModel)]="user.gender">
              <mat-option value="male">Male</mat-option>
              <mat-option value="female">Female</mat-option>
              <mat-option value="other">Other</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Email -->
          <mat-form-field appearance="outline"
                          class="full-width">
            <mat-label>Email</mat-label>
            <input matInput
                   [(ngModel)]="user.email">
          </mat-form-field>
        </div>

        <div class="profile-actions">
          <button mat-raised-button
                  color="primary"
                  (click)="saveProfile()">Save</button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="history-posts-container">
    <h2 style="text-align: center;">My Post</h2>
    <div class="post-block">
      <h3>My Houses</h3>
      <div class="history-cards">
        <mat-card *ngFor="let house of houses"
                  class="history-card">
          <div class="image-carousel-container">
            <button class="prev-image-button"
                    *ngIf="house.safeImagePaths && house.safeImagePaths.length > 1"
                    (click)="prevImage(house); $event.stopPropagation()">
              <mat-icon>arrow_back</mat-icon>
            </button>
            <img [src]="house.safeImagePaths[house.currentImageIndex]"
                 alt="{{ house.title }}"
                 class="history-card-img" />
            <button class="next-image-button"
                    *ngIf="house.safeImagePaths && house.safeImagePaths.length > 1"
                    (click)="nextImage(house); $event.stopPropagation()">
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>

          <mat-card-content>
            <p><strong>Title:</strong> {{ house.title }}</p>
            <p><strong>Price:</strong> ${{ house.price }}</p>
            <p><strong>Location:</strong> {{ house.location }}</p>
          </mat-card-content>

          <!-- Card Actions -->
          <mat-card-actions>
            <div class="card-actions-left">
              <span><mat-icon>thumb_up</mat-icon> {{ house.likeCount }}</span>
              <span><mat-icon>visibility</mat-icon> {{ house.viewCount }}</span>
            </div>

            <div class="card-actions-right">
              <!-- Update Button -->
              <button mat-raised-button
                      color="primary"
                      (click)="openUpdateDialog(house)"
                      class="update-button">
                <mat-icon>edit</mat-icon> Update
              </button>

              <!-- Delete Button -->
              <button mat-raised-button
                      color="warn"
                      (click)="deleteHouse(house.id)"
                      class="delete-button">
                <mat-icon>delete</mat-icon> Delete
              </button>
            </div>
          </mat-card-actions>


        </mat-card>
      </div>

    </div>

    <!-- Land Block -->
    <div class="post-block">
      <h3>My Lands</h3>
      <div class="history-cards">
        <mat-card *ngFor="let land of lands"
                  class="history-card">

          <!-- Image Carousel -->
          <div class="image-carousel-container">
            <!-- Previous Button -->
            <button class="prev-image-button"
                    *ngIf="land.safeImagePaths && land.safeImagePaths.length > 1"
                    (click)="prevImage(land); $event.stopPropagation()">
              <mat-icon>arrow_back</mat-icon>
            </button>

            <!-- Display Current Image -->
            <img [src]="land.safeImagePaths[land.currentImageIndex]"
                 alt="{{ land.title }}"
                 class="history-card-img" />

            <!-- Next Button -->
            <button class="next-image-button"
                    *ngIf="land.safeImagePaths && land.safeImagePaths.length > 1"
                    (click)="nextImage(land); $event.stopPropagation()">
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>


          <mat-card-content>
            <p><strong>Title:</strong>{{ land.title }}</p>
            <p><strong>Price:</strong> ${{ land.price }}</p>
            <p><strong>Location:</strong> {{ land.location }}</p>
          </mat-card-content>


          <mat-card-actions>
            <div class="card-actions-left">
              <span><mat-icon>thumb_up</mat-icon> {{ land.likeCount }}</span>
              <span><mat-icon>visibility</mat-icon> {{ land.viewCount }}</span>
            </div>

            <div class="card-actions-right">
              <!-- Update Button -->
              <button mat-raised-button
                      color="primary"
                      class="update-button">
                <mat-icon>edit</mat-icon> Update
              </button>

              <!-- Delete Button -->
              <button mat-raised-button
                      color="warn"
                      (click)="deleteLand(land.id)"
                      class="delete-button">
                <mat-icon>delete</mat-icon> Delete
              </button>
            </div>
          </mat-card-actions>


        </mat-card>
      </div>

    </div>

    <!-- Room Block -->
    <div class="post-block">
      <h3>My Rooms</h3>
      <div class="history-cards">
        <mat-card *ngFor="let room of rooms"
                  class="history-card">

          <!-- Image Carousel -->
          <div class="image-carousel-container">
            <!-- Previous Button -->
            <button class="prev-image-button"
                    *ngIf="room.safeImagePaths && room.safeImagePaths.length > 1"
                    (click)="prevImage(room); $event.stopPropagation()">
              <mat-icon>arrow_back</mat-icon>
            </button>

            <!-- Display Current Image -->
            <img [src]="room.safeImagePaths[room.currentImageIndex]"
                 alt="{{ room.title }}"
                 class="history-card-img" />

            <!-- Next Button -->
            <button class="next-image-button"
                    *ngIf="room.safeImagePaths && room.safeImagePaths.length > 1"
                    (click)="nextImage(room); $event.stopPropagation()">
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>

          <mat-card-content>
            <p><strong>Title:</strong> {{ room.title }}</p>
            <p><strong>Price:</strong> ${{ room.price }}</p>
            <p><strong>Location:</strong> {{ room.location }}</p>
          </mat-card-content>

          <!-- Card Actions -->
          <mat-card-actions>
            <div class="card-actions-left">
              <span><mat-icon>thumb_up</mat-icon> {{ room.likeCount }}</span>
              <span><mat-icon>visibility</mat-icon> {{ room.viewCount }}</span>
            </div>

            <div class="card-actions-right">
              <!-- Update Button -->
              <button mat-raised-button
                      color="primary"
                      class="update-button">
                <mat-icon>edit</mat-icon> Update
              </button>

              <!-- Delete Button -->
              <button mat-raised-button
                      color="warn"
                      (click)="deleteRoom(room.id)"
                      class="delete-button">
                <mat-icon>delete</mat-icon> Delete
              </button>
            </div>
          </mat-card-actions>


        </mat-card>
      </div>

    </div>
  </div>
